<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Audio</title>

    <script src="https://kit.fontawesome.com/66d7b97049.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="./css/MusicPlayer.css">
    <link rel="stylesheet" href="./css/customize-progress-bar.css">

</head>

<body>

    <h1>Hola</h1>
    <h2>Reproductor</h2>

    <div class="music-player">
        <div class="audio-player">
            <!-- Contenedor - Información de la canción -->
            <div class="track-info">
                <div>
                    <!-- Canción -->
                    <audio id="audio" src="" aria-label="Reproductor de audio"></audio>

                    <!-- Información de la canción -->
                    <div class="audio-info">
                        <!-- Carátula de la canción -->
                        <div class="audio-image">
                            <img id="audioImage" src="" alt="Carátula de la canción actual" role="presentation">
                        </div>
                        <!-- Título y autor -->
                        <div class="main-track-info">
                            <h3 class="title" aria-live="polite"></h3>
                            <h4 class="author" aria-live="polite"></h4>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Contenedor controles del reproductor -->
            <div class="controls-wrapper">
                <!-- Controles -->
                <div class="playback-controls">
                    <button aria-label="Canción anterior" id="previousBtn">
                        <i class="fa fa-step-backward" aria-hidden="true"></i>
                    </button>
                    <button id="skipBackwardBtn" class="skipBackward" aria-label="Retroceder 5 segundos">
                        <i class="fa fa-backward" aria-hidden="true"></i>
                    </button>
                    <button class="play-pause-btn" aria-label="Reproducir o pausar" id="playPauseBtn">
                        <i class="fa fa-play" aria-hidden="true"></i>
                    </button>
                    <button id="skipForwardBtn" class="skipForward" aria-label="Avanzar 5 segundos">
                        <i class="fa fa-forward" aria-hidden="true"></i>
                    </button>
                    <button aria-label="Canción siguiente" id="nextBtn">
                        <i class="fa fa-step-forward" aria-hidden="true"></i>
                    </button>
                </div>

                <!-- Volumen -->
                <div class="volume-controls">
                    <button class="volume-btn" aria-label="Silenciar o activar sonido" id="muteVolumeBtn">
                        <i class="fa fa-volume-up" aria-hidden="true"></i>
                    </button>
                    <label for="volumeSlider" class="sr-only">Volumen de la canción</label>
                    <input id="volumeSlider" type="range" class="volume-slider" name="volumen"
                        aria-label="Control de volumen" min="0" max="100" value="60">
                </div>
            </div>
            <!-- Contenedor barra de progreso y playlist -->
            <div class="progress-and-playlist">
                <!-- Barra de progreso -->
                <div class="progress">
                    <span class="time current currentTime"></span>
                    <label for="progressBarRange" class="sr-only">Progreso de la canción</label>
                    <input type="range" id="progressBarRange" class="progress-bar-range" name="progreso-de-la-cancion"
                        aria-label="Barra de progreso de la canción" value="" max="" />
                    <span class="time audioDuration"></span>
                </div>
                <!-- PlayList del reproductor -->
                <div class="playlist" aria-label="Lista de reproducción">
                    <ul id="playlist">
                        <!-- Elementos de la lista aquí -->
                    </ul>
                </div>

            </div>
        </div>
    </div>



    <div id="buscador">
        <!-- Campo de Búsqueda -->
        <input type="text" id="campo-buscar" placeholder="Buscar en el sitio...">
        <!-- Botón para Realizar la Búsqueda -->
        <button id="boton-buscar">Buscar</button>
    </div>

    <!-- Div para Mostrar los Resultados de la Búsqueda -->
    <div id="resultados-busqueda"></div>


    <script type="module" src="js/audio-player.js">  </script>


    <script>
        // Función para cargar y almacenar contenido de las páginas
        function cargarContenido() {
            const paginas = ['index.html', 'musica.html', /* otras páginas aquí */];
            paginas.forEach(url => {
                fetch(url).then(response => response.text()).then(html => {
                    localStorage.setItem(url, html); // Guardar contenido en localStorage
                });
            });
        }

        // Función de búsqueda en el contenido almacenado
        function buscar(query) {
            const resultados = [];
            const etiquetas = ['title', 'p', 'a', 'h1', 'h2', 'h3', 'h4']; // Agrega aquí más etiquetas si es necesario
            const paginas = ['index.html', 'musica.html', 'sobre-mi.html', '/hobbies/index.html'];

            paginas.forEach(url => {
                const contenido = localStorage.getItem(url);
                const parser = new DOMParser();
                const doc = parser.parseFromString(contenido, 'text/html');

                etiquetas.forEach(etiqueta => {
                    const elementos = doc.querySelectorAll(etiqueta);
                    elementos.forEach(elemento => {
                        if (elemento.textContent.toLowerCase().includes(query.toLowerCase())) {
                            const texto = elemento.textContent;
                            const startIndex = texto.toLowerCase().indexOf(query.toLowerCase());
                            const endIndex = startIndex + query.length;
                            const fragmentStart = Math.max(startIndex - 100, 0);
                            const fragmentEnd = Math.min(endIndex + 100, texto.length);
                            const fragment = texto.substring(fragmentStart, fragmentEnd).replace(new RegExp(query, 'gi'), `<mark>${query}</mark>`);

                            resultados.push({ url, fragment });
                        }
                    });
                });
            });

            return resultados;
        }



        // Función para mostrar resultados
        function mostrarResultados(resultados) {
            const resultadosDiv = document.getElementById('resultados-busqueda');
            resultadosDiv.innerHTML = '';
            resultados.forEach(({ url, fragment }) => {
                resultadosDiv.innerHTML += `<div><a href="${url}">${url}</a><p>${fragment}</p></div>`;
            });
        }


        // Inicializar la carga de contenido cuando la página se carga
        document.addEventListener('DOMContentLoaded', cargarContenido);

        // Ejemplo de cómo usar la función de búsqueda
        document.getElementById('boton-buscar').addEventListener('click', () => {
            const query = document.getElementById('campo-buscar').value;
            const resultados = buscar(query);
            mostrarResultados(resultados);
        });

    </script>
</body>

</html>